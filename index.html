<!DOCTYPE html>
<html class="mouse">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>GodsPeople</title>
    <!-- Behavioral Meta Data -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- Core Meta Data -->
    <meta name="author" content="Matthew Wagerfield">
    <meta name="description" content="GodsPeople, lightweight Parallax Engine that reacts to the orientation of a smart device">
    <meta name="keywords" content="GodsPeople">
    <!-- Styles -->
    <!--<link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">-->
    <link rel="stylesheet" href="./assets/fonts/simple-line-icons/simple-line-icons.min.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/styles.css">
    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.png" type="image/png">
    <link rel="shortcut icon" href="favicon.png" type="image/png">
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./assets/img/apple-touch-icon/144x144.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/img/apple-touch-icon/114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/img/apple-touch-icon/72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="./assets/img/apple-touch-icon/57x57.png">
    <!-- Apple Startup Images -->
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-320x460.png" media="(device-width: 320px)">
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-640x920.png" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-768x1004.png" media="(device-width: 768px) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-748x1024.png" media="(device-width: 768px) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-1536x2008.png" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="./image/apple-touch-startup-image-2048x1496.png" media="(device-width: 1536px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)">
</head>
<body>
    <div id="fb-root"></div>
    <div id="container" class="wrapper">
        <div id="scene" class="scene unselectable" data-friction-x="0.1" data-friction-y="0.1" data-scalar-x="25" data-scalar-y="15">
            <div class="layer" data-depth="0.00"></div>
            <div class="layer" data-depth="0.1">
                <img id="cover" src="images/background.jpg" />
            </div>
            <div class="layer" data-depth="0.20"><h1 class="title">神的<em>子民</em></h1></div>
            <div class="layer" data-depth="0.30"><p class="quotes">圣经都是神所默示的，于教训，督责，使人归正，教导人学义，都是有益的.<br /><em>提后3：16</em></p></div>
        </div>
        <section id="about" class="wrapper about accelerate hide">
            <div class="cell accelerate">
                <div class="cables center accelerate">
                    <div class="panel accelerate">
                        <div class="panel-item active" id="panel_1">
                            <header>
                                <h2>旧约</h2>
                            </header>
                            <div class="swiper-container swiper1">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide swiper-no-swiping">
                                        <div id="dic1" class="swiper-slide-panel"></div>
                                    </div>
                                    <div class="swiper-slide">
                                        <div id="cnt1" class="swiper-slide-panel"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-item" id="panel_2">
                            <header>
                                <h2>新约</h2>
                            </header>
                            <div class="swiper-container swiper2">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide swiper-no-swiping">
                                        <div id="dic2" class="swiper-slide-panel"></div>
                                    </div>
                                    <div class="swiper-slide">
                                        <div id="cnt2" class="swiper-slide-panel"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-item" id="panel_3">
                            <header>
                                <h2>壁纸</h2>
                            </header>
                            <div class="swiper-container swiper3" style="width: 80%;margin-bottom:20px;">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide">
                                        <img src="images/background.jpg" />
                                    </div>
                                    <div class="swiper-slide">
                                        <img src="images/background2.jpg" />
                                    </div>
                                    <div class="swiper-slide">
                                        <img src="images/background3.jpg" />
                                    </div>
                                    <div class="swiper-slide">
                                        <img src="images/background4.jpg" />
                                    </div>
                                    <div class="swiper-slide">
                                        <img src="images/background5.jpg" />
                                    </div>
                                    <div class="swiper-slide">
                                        <img src="images/background6.jpg" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-item" id="panel_4">
                            <header>
                                <h2>音乐</h2>
                            </header>
                            <div id="player" class="aplayer" style="padding: 20px 20px 10px 20px;box-shadow: none;"></div>
                        </div>
                        <ul class="links">
                            <li style="width:25%;" tab="#panel_1"><a href="javascript:;" class="active"><i class="icon-notebook"></i> 旧约</a></li>
                            <li style="width:25%;" tab="#panel_2"><a href="javascript:;"><i class="icon-notebook"></i> 新约</a></li>
                            <li style="width:25%;" tab="#panel_3"><a href="javascript:;"><i class="icon-picture"></i> 壁纸</a></li>
                            <li style="width:25%;" tab="#panel_4"><a href="javascript:;"><i class="icon-music-tone-alt"></i> 音乐</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <button id="toggle" class="toggle i">
            <div class="cross">
                <div class="x"></div>
                <div class="y"></div>
            </div>
        </button>
        <div id="prompt" class="wrapper prompt hide accelerate">
            <div class="cell accelerate">
                <div class="panel center unselectable accelerate">
                    <button id="dismiss" class="dismiss">
                        <div class="cross">
                            <div class="x"></div>
                            <div class="y"></div>
                        </div>
                    </button>
                    <div class="tilt-scene">
                        <img class="tilt" src="./assets/img/tilt.png">
                    </div>
                    <h2>Tilting is fun!</h2>
                    <p>For the best experience, check out this site on a mobile or tablet equipped with a gyroscope</p>
                    <p>(iPads are the coolest)</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script src="./assets/js/libraries.min.js"></script>
    <script src="./assets/js/swiper.min.js"></script>
    <script src="./assets/js/APlayer.min.js"></script>
    <script src="./assets/js/jquery.parallax.js"></script>
    <script type="text/javascript">
        var app = function () {

            var self = this;

            var swiper1, swiper2, swiper3;

            this.layout = function () {
                var $html = $('html'), $container = $('#container'), $prompt = $('#prompt'), $toggle = $('#toggle'), $about = $('#about'), $scene = $('#scene');

                // Hide browser menu.
                (function () {
                    setTimeout(function () { window.scrollTo(0, 0); }, 0);
                })();

                // Setup FastClick.
                FastClick.attach(document.body);

                // Add touch functionality.
                if (Hammer.HAS_TOUCHEVENTS) {
                    $container.hammer({ drag_lock_to_axis: true });
                    _.tap($html, 'a,button,[data-tap]');
                }

                // Add touch or mouse class to html element.
                $html.addClass(Hammer.HAS_TOUCHEVENTS ? 'touch' : 'mouse');

                // Resize handler.
                (resize = function () {
                    $scene[0].style.width = window.innerWidth + 'px';
                    $scene[0].style.height = window.innerHeight + 'px';
                    if (!$prompt.hasClass('hide')) {
                        if (window.innerWidth < 600) {
                            $toggle.addClass('hide');
                        } else {
                            $toggle.removeClass('hide');
                        }
                    }

                    var img = new Image();
                    img.src = $('#cover').attr('src');
                    img.onload = function () {
                        var w = img.width;
                        var h = img.height;

                        function setCover(id, w, h) {
                            var _height = $(id).parent().height(),
                                _width = $(id).parent().width(),
                                ratio = h / w;

                            if (_height / _width > ratio) {
                                id.style.height = _height * 1.1 + 'px';
                                id.style.width = _height / ratio * 1.1 + 'px';
                                //id.style.marginLeft = -0.5 * (_height / ratio - window.innerWidth) + 'px';

                            } else {
                                id.style.width = _width * 1.1 + 'px';
                                id.style.height = _width * ratio * 1.1 + 'px';
                            }

                            id.style.left = (_width - parseInt(id.style.width)) / 2 + 'px';
                            id.style.top = (_height - parseInt(id.style.height)) / 2 + 'px';
                        }

                        setCover($('#cover')[0], w, h)
                    }
                })();

                // Attach window listeners.
                window.onresize = _.debounce(resize, 200);
                window.onscroll = _.debounce(resize, 200);

                // Listen for toggle click event.
                $toggle.on('click', function (event) {

                    function showDetails() {
                        $about.removeClass('hide');
                        $toggle.removeClass('i');
                    }

                    function hideDetails() {
                        $about.addClass('hide');
                        $toggle.addClass('i');
                    }

                    $toggle.hasClass('i') ? showDetails() : hideDetails();
                });

                // Pretty simple huh?
                $scene.parallax();

                // Check for orientation support.
                setTimeout(function () {
                    if ($scene.data('mode') === 'cursor') {
                        $prompt.removeClass('hide');
                        if (window.innerWidth < 600) $toggle.addClass('hide');
                        $prompt.on('click', function (event) {
                            $prompt.addClass('hide');
                            if (window.innerWidth < 600) {
                                setTimeout(function () {
                                    $toggle.removeClass('hide');
                                }, 1200);
                            }
                        });
                    }
                }, 1000);
            }

            this.tabs = function () {
                $('.links li').click(function () {
                    $('.panel-item').removeClass('active');
                    $('.links a').removeClass('active');
                    $(this).find('a').addClass('active');
                    var tab = $(this).attr('tab');
                    $(tab).addClass('active');
                    swiper1.update();
                    swiper2.update();
                    swiper3.update();
                })
                function fixd400SwiperBug(swiper) {
                    if (window.innerWidth < 400) {
                        var slide = swiper.slides[0];
                        $(slide).parent().width($(slide).width());
                    }
                }
                //tab1
                swiper1 = new Swiper('.swiper1', {
                    autoHeight: true,
                    nextButton: '.button-next1',
                    prevButton: '.button-prev1',
                    roundLengths: true,
                    onInit: function (swiper) {
                        fixd400SwiperBug(swiper)
                    }
                });
                //tab2
                swiper2 = new Swiper('.swiper2', {
                    autoHeight: true,
                    nextButton: '.button-next2',
                    prevButton: '.button-prev2',
                    onInit: function (swiper) {
                        fixd400SwiperBug(swiper)
                    }
                });
                //tab3
                var bgcover = parseInt(localStorage.getItem('bgcover') == undefined ? 0 : localStorage.getItem('bgcover'));
                swiper3 = new Swiper('.swiper3', {
                    initialSlide: bgcover,
                    onInit: function (swiper) {
                        fixd400SwiperBug(swiper)
                    },
                    onSlideChangeEnd: function (swiper) {
                        var slide = swiper.slides[swiper.activeIndex];
                        var src = $(slide).find('img').attr('src');
                        $('#cover').attr('src', src);
                        //缓存封面
                        localStorage.setItem('bgcover', swiper.activeIndex);
                    }
                });
                //tab4
                var ap1 = new APlayer({
                    element: document.getElementById('player'),
                    narrow: false,
                    autoplay: false,
                    showlrc: false,
                    mutex: true,
                    theme: '#e6d0b2',
                    preload: 'metadata',
                    mode: 'circulation',
                    listmaxheight: '120px',
                    music: [{
                        title: 'Amazing Grace',
                        author: 'Judy Collins',
                        url: './assets/muisc/Amazing Grace.mp3',
                        pic: './assets/muisc/Amazing Grace.jpg'
                    }, {
                        title: 'Pie Jesu',
                        author: 'Sarah Brightman',
                        url: './assets/muisc/Pie Jesu.mp3',
                        pic: './assets/muisc/Pie Jesu.jpg'
                    }]
                });
            }

            this.dics = function () {
                return $.getJSON('./bible/dic.json').done(function (rst) {
                    var dic = "#dic1";
                    var cnt = "#cnt1";
                    rst.forEach(function (item) {
                        if (item.chapter == "") {
                            dic = "#dic2";
                            cnt = "#cnt2";
                        } else {
                            var $item = $('<a>' + item.chapter + item.summary + '</a>');
                            $item.data('sections', item.sections);
                            $item.data('cnt', cnt);
                            $item.click(function () {
                                var cnt = $(this).data('cnt');
                                var sections = $(this).data('sections');
                                $(cnt).html('');

                                self.sections(sections, 0, cnt).done(function () {
                                    if (cnt == '#cnt1') {
                                        swiper1.slideNext();
                                    } else if (cnt == '#cnt2') {
                                        swiper2.slideNext();
                                    }
                                });
                            })
                            var $p = $('<p></p>').append($item);
                            $(dic).append($p);
                        }
                    });
                })
            }

            this.sections = function (sections, i, cnt) {
                $(cnt).html('');

                var $btn;
                if (i < sections.length - 1) {
                    $btn = $('<a>下一节</a>')
                    $btn.click(function () {
                        self.sections(sections, i + 1, cnt);
                    });
                } else {
                    $btn = $('<a>本节完</a>')
                    $btn.click(function () {
                        if (cnt == '#cnt1') {
                            swiper1.slidePrev();
                        } else if (cnt == '#cnt2') {
                            swiper2.slidePrev();
                        }
                    });
                }
                var $p = $('<p></p>').append($btn);
                
                return $.getJSON('./bible/' + sections[i] + '.json').done(function (rst2) {
                    var $div = $('<div></div>');
                    $div.append('<p><a>' + sections[i] + '</a></p>');
                    rst2.forEach(function (item2) {
                        $div.append('<p style="text-align: left;"><a>' + item2.section + '</a> ' + (item2.zh == undefined ? '' : item2.zh) + '</p>');
                    });
                    $div.append($p);
                    $(cnt).append($div);
                });
            }

        }

        $(document).ready(function () {
            var app1 = new app();
            app1.layout();
            app1.dics().done(function () {
                app1.tabs();
            });
        })
    </script>

</body>
</html>